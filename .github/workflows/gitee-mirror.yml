#
# Licensed to the Apache Software Foundation (ASF) under one
# or more contributor license agreements.  See the NOTICE file
# distributed with this work for additional information
# regarding copyright ownership.  The ASF licenses this file
# to you under the Apache License, Version 2.0 (the
# "License"); you may not use this file except in compliance
# with the License.  You may obtain a copy of the License at
#
#   http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing,
# software distributed under the License is distributed on an
# "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
# KIND, either express or implied.  See the License for the
# specific language governing permissions and limitations
# under the License.
#

# ä½¿ç”¨ GitHub Action æ¥è§£å†³æ‰‹åŠ¨åŒæ­¥åˆ° Gitee çš„é—®é¢˜
# æ•ˆæœï¼šgithub repo ä»£ç æ›´æ–°ä¹‹åï¼Œä¼šè‡ªåŠ¨åŒæ­¥è‡³ gitee
# ä½¿ç”¨åˆ°çš„ GitHub Actionï¼šhttps://github.com/Yikun/hub-mirror-action

# This is a basic workflow to help you get started with Actions

name: Gitee Mirror

# Controls when the action will run. Triggers the workflow on push or pull request
# events but only for the master branch
on:
  push:
    branches:
      - '*'

jobs:
  # This workflow contains a single job called "build"
  build:
    # The type of runner that the job will run on
    runs-on: ubuntu-latest

    # Steps represent a sequence of tasks that will be executed as part of the job
    steps:
      - name: Mirror the Github organization repos to Gitee.
        uses: Yikun/hub-mirror-action@master
        with:
          src: github/WeBankFinTech
          dst: gitee/webank
          # è¿™é‡Œè¯·å¡«å†™ä¸giteeä¸Šå…¬é’¥åŒ¹é…çš„çš„ ssh private keyï¼Œå‚è§ï¼šhttps://gitee.com/profile/sshkeys
          # å¡«å†™åœ°å€ï¼šhttps://github.com/WeBankFinTech/fes.js/settings/secrets
          dst_key: ${{ secrets.GITEE_PRIVATE_KEY }}
          # è¿™é‡Œè¯·å¡«å†™ giteeçš„ä»¤ç‰Œï¼Œå‚è§ï¼šhttps://gitee.com/profile/personal_access_tokens
          # å¡«å†™åœ°å€ï¼šhttps://github.com/WeBankFinTech/fes.js/settings/secrets
          dst_token: ${{ secrets.GITEE_TOKEN }}
          # é¡¹ç›®åŒæ­¥ç™½åå•ï¼Œå¯ä»¥é€‰æ‹©å¡«å†™å¤šä¸ªï¼Œä»¥è‹±æ–‡é€—å·åˆ†å‰²
          static_list: "EventMesh"
          # æ˜¯å¦å¼ºåˆ¶åŒæ­¥
          force_update: true
          # è´¦å·ç±»å‹ï¼šå¯¹ luban-h5 è€Œè¨€æ˜¯ userï¼Œå› ä¸ºæ˜¯ä¸ªäººé¡¹ç›®ï¼›å¦‚æœæ˜¯ä¼ä¸šé¡¹ç›®ï¼Œè¯·å¡«å†™ orgï¼Œå› ä¸ºæ˜¯ç»„ç»‡ä¸‹çš„é¡¹ç›®
          account_type: org
          clone_style: ssh

  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout ğŸ›ï¸
        uses: actions/checkout@v2 # If you're using actions/checkout@v2 you must set persist-credentials to false in most cases for the deployment to work correctly.
        with:
          persist-credentials: false

      - name: Install and Build ğŸ”§ # This example project is built using npm and outputs the result to the 'build' folder. Replace with the commands required to build your project, or remove this step entirely if your site is pre-built.
        run: |
          yarn install
          yarn run docs:build
      - name: Deploy ğŸš€
        uses: JamesIves/github-pages-deploy-action@3.7.1
        with:
          GITHUB_TOKEN: ${{ secrets.EVENTMESH }}
          BRANCH: gh-pages
          FOLDER: docs/.vuepress/dist # The folder the action should deploy.
