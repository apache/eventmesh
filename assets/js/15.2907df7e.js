(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{373:function(t,e,s){t.exports=s.p+"assets/img/adjust-queue-expand-p1.294f617d.png"},374:function(t,e,s){t.exports=s.p+"assets/img/adjust-queue-shrink-p1.f794f0d9.png"},397:function(t,e,s){"use strict";s.r(e);var r=s(42),u=Object(r.a)({},(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[r("h2",{attrs:{id:"自动伸缩queue"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#自动伸缩queue"}},[t._v("#")]),t._v(" 自动伸缩Queue")]),t._v(" "),r("p",[t._v("      \n在同一个消费组内，每个队列只由一个实例消费。当队列数小于消费者实例数时，会有部分消费者实例分不到队列；反之，当队列数大于消费者实例数时，每个消费者需要消费多个队列。队列数不是消费者实例数的整数倍时，则会出现部分实例需要消费比同组内的其他实例更多的队列，出现负载不均衡问题。")]),t._v(" "),r("p",[t._v("      \nDeFiBus提供了队列数量自动调整的特性。当有Consumer新注册或者去注册时，Broker触发队列的自动伸缩，根据当前在线的消费者实例个数，增加或者减少队列个数，使队列个数与消费者实例数保持一致。")]),t._v(" "),r("p",[t._v("      \n当队列数需要增加时，首先调整Topic的ReadQueueNum，将可读的队列数扩增；10s之后，再调整Topic的WriteQueueNum，将可写的队列数扩增。这样使得新扩增的队列能够先被消费者感知并监听上，然后才让生产者感知到，往新队列上发送消息，是扩增操作更平滑。")]),t._v(" "),r("div",{attrs:{align:"center"}},[r("img",{attrs:{src:s(373),width:"500"}})]),t._v(" "),r("p",[t._v("      \n当队列数需要减少时，首先调整Topic的WriteQueueNum，将可写的队列数缩减；5分钟（默认，可配置）后先检查即将被缩减的队列中是否有消息没有被消费完，如果有，则继续延迟缩减操作，使消费者能够继续消费完队列中的消息；如果没有，则调整ReadQueueNum，将可写的队列数缩减。")]),t._v(" "),r("div",{attrs:{align:"center"}},[r("img",{attrs:{src:s(374),width:"500"}})]),t._v(" "),r("p",[t._v("      \n对于多个消费组订阅相同Topic并且是集群消费模式时，在计算扩缩的队列个数时，以最大的消费组的消费者实例数为准，保证拥有最多实例数的消费组内每个消费者实例都能够分到Queue进行消费。")]),t._v(" "),r("hr"),t._v(" "),r("h4",{attrs:{id:"links"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#links"}},[t._v("#")]),t._v(" Links:")]),t._v(" "),r("ul",[r("li",[r("RouterLink",{attrs:{to:"/"}},[t._v("架构介绍")])],1),t._v(" "),r("li",[r("RouterLink",{attrs:{to:"/cn/features/docs/cn/features/1-request-response-call.html"}},[t._v("Request-Reply调用")])],1),t._v(" "),r("li",[r("RouterLink",{attrs:{to:"/cn/features/docs/cn/features/2-dark-launch.html"}},[t._v("灰度发布")])],1),t._v(" "),r("li",[r("RouterLink",{attrs:{to:"/cn/features/docs/cn/features/3-circuit-break-mechanism.html"}},[t._v("熔断机制")])],1),t._v(" "),r("li",[r("RouterLink",{attrs:{to:"/cn/features/docs/cn/features/4-invoke-service-nearby.html"}},[t._v("服务就近")])],1),t._v(" "),r("li",[r("RouterLink",{attrs:{to:"/cn/features/docs/cn/features/5-multi-active.html"}},[t._v("应用多活")])],1),t._v(" "),r("li",[r("RouterLink",{attrs:{to:"/cn/features/docs/cn/features/6-dynamic-adjust-queue.html"}},[t._v("动态扩缩队列")])],1),t._v(" "),r("li",[r("RouterLink",{attrs:{to:"/cn/features/docs/cn/features/8-fault-tolerant.html"}},[t._v("容错机制")])],1)])])}),[],!1,null,null,null);e.default=u.exports}}]);