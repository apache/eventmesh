(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{323:function(t,s,n){t.exports=n.p+"assets/img/eventmesh-rr-msg.f857f1b0.png"},324:function(t,s,n){t.exports=n.p+"assets/img/eventmesh-async-msg.032fb180.png"},325:function(t,s,n){t.exports=n.p+"assets/img/eventmesh-broadcast-msg.668b9e8c.png"},373:function(t,s,n){t.exports=n.p+"assets/img/eventmesh-tcp-dataFlow.405dbb83.png"},396:function(t,s,n){"use strict";n.r(s);var a=n(42),e=Object(a.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h2",{attrs:{id:"tcp协议文档"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#tcp协议文档"}},[t._v("#")]),t._v(" TCP协议文档")]),t._v(" "),a("h4",{attrs:{id:"_1-协议格式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-协议格式"}},[t._v("#")]),t._v(" 1. 协议格式")]),t._v(" "),a("p",[a("img",{attrs:{src:n(373),alt:"dataFlow"}})]),t._v(" "),a("p",[a("strong",[t._v("消息组成详解：")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("魔术字：4位，当前值为“WEMQ”\n\n通信协议版本号：4位，当前值为“0000”\n\n消息总长度值(length)：4位，int类型\n\n消息头长度值(headerLength)：4位，int类型\n\n消息头(header)：长度 = headerLength\n\n消息体(body)：长度 = length - headerLength - 4 - 4  \n")])])]),a("h4",{attrs:{id:"_2-业务逻辑层"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-业务逻辑层"}},[t._v("#")]),t._v(" 2. 业务逻辑层")]),t._v(" "),a("ul",[a("li",[t._v("消息组成")])]),t._v(" "),a("p",[t._v("消息头（header）+ 消息体（body）")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Package")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Header")]),t._v(" header"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Object")]),t._v(" body"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Header")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Command")]),t._v(" cmd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" msg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" seq"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("ul",[a("li",[t._v("详解")])]),t._v(" "),a("p",[t._v("消息头(header)：类型为Header，Header中有Command字段，用于区分不同的消息类型")]),t._v(" "),a("p",[t._v("消息体(body)：对于不同的消息类型，body的类型不同")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("消息命令字")]),t._v(" "),a("th",[t._v("body类型")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("HEARTBEAT_REQUEST, HEARTBEAT_RESPONSE, HELLO_RESPONSE, CLIENT_GOODBYE_REQUEST, CLIENT_GOODBYE_RESPONSE, SERVER_GOODBYE_REQUEST, SERVER_GOODBYE_RESPONSE, LISTEN_REQUEST, LISTEN_RESPONSE, UNSUBSCRIBE_REQUEST, SUBSCRIBE_RESPONSE, UNSUBSCRIBE_RESPONSE, ASYNC_MESSAGE_TO_SERVER_ACK, BROADCAST_MESSAGE_TO_SERVER_ACK")]),t._v(" "),a("td",[t._v("无")])]),t._v(" "),a("tr",[a("td",[t._v("HELLO_REQUEST")]),t._v(" "),a("td",[t._v("UserAgent")])]),t._v(" "),a("tr",[a("td",[t._v("SUBSCRIBE_REQUEST")]),t._v(" "),a("td",[t._v("Subscription")])]),t._v(" "),a("tr",[a("td",[t._v("REQUEST_TO_SERVER, REQUEST_TO_CLIENT, RESPONSE_TO_SERVER, RESPONSE_TO_CLIENT, ASYNC_MESSAGE_TO_SERVER, ASYNC_MESSAGE_TO_CLIENT, BROADCAST_MESSAGE_TO_SERVER, BROADCAST_MESSAGE_TO_CLIENT, ASYNC_MESSAGE_TO_CLIENT_ACK, BROADCAST_MESSAGE_TO_CLIENT_ACK, RESPONSE_TO_CLIENT_ACK, REQUEST_TO_CLIENT_ACK")]),t._v(" "),a("td",[t._v("OpenMessage")])]),t._v(" "),a("tr",[a("td",[t._v("REDIRECT_TO_CLIENT")]),t._v(" "),a("td",[t._v("RedirectInfo")])])])]),t._v(" "),a("h4",{attrs:{id:"_3-client-与-eventmesh-runtime-server-交互场景详解"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-client-与-eventmesh-runtime-server-交互场景详解"}},[t._v("#")]),t._v(" 3. Client 与 Eventmesh-Runtime(Server)交互场景详解")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("enum")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Command")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//心跳")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("HEARTBEAT_REQUEST")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("                              "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//client发给server的心跳包")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("HEARTBEAT_RESPONSE")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("                             "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//server回复client的心跳包")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//握手")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("HELLO_REQUEST")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("                                  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//client发给server的握手请求")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("HELLO_RESPONSE")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("                                 "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//server回复client的握手请求")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//断连")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("CLIENT_GOODBYE_REQUEST")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("                         "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//client主动断连时通知server")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("CLIENT_GOODBYE_RESPONSE")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("                        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//server回复client的主动断连通知")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("SERVER_GOODBYE_REQUEST")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("                         "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//server主动断连时通知client")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("SERVER_GOODBYE_RESPONSE")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("                        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//client回复server的主动断连通知")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//订阅管理")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("SUBSCRIBE_REQUEST")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("                              "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//client发给server的订阅请求")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("SUBSCRIBE_RESPONSE")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("9")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("                             "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//server回复client的订阅请求")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("UNSUBSCRIBE_REQUEST")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("                           "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//client发给server的取消订阅请求")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("UNSUBSCRIBE_RESPONSE")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("11")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("                          "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//server回复client的取消订阅请求")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//监听")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("LISTEN_REQUEST")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("12")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("                            \t   "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//client发给server的启动监听请求")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("LISTEN_RESPONSE")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("13")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("                               "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//server回复client的监听请求")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//RR")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("REQUEST_TO_SERVER")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("                             "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//client将RR请求发送给server")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("REQUEST_TO_CLIENT")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("                             "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//server将RR请求推送给client")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("REQUEST_TO_CLIENT_ACK")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("16")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("                         "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//client收到RR请求后ACK给server")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("RESPONSE_TO_SERVER")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("17")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("                            "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//client将RR回包发送给server")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("RESPONSE_TO_CLIENT")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("18")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("                            "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//server将RR回包推送给client")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("RESPONSE_TO_CLIENT_ACK")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("19")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("                        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//client收到回包后ACK给server")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//异步事件")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ASYNC_MESSAGE_TO_SERVER")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("                       "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//client将异步事件发送给server")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ASYNC_MESSAGE_TO_SERVER_ACK")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("21")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("                   "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//server收到异步事件后ACK给client")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ASYNC_MESSAGE_TO_CLIENT")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("22")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("                       "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//server将异步事件推送给client")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ASYNC_MESSAGE_TO_CLIENT_ACK")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("23")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("                   "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//client收到异步事件后ACK给server")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//广播")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("BROADCAST_MESSAGE_TO_SERVER")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("24")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("                   "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//client将广播消息发送给server")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("BROADCAST_MESSAGE_TO_SERVER_ACK")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("25")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("               "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//server收到广播消息后ACK给client")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("BROADCAST_MESSAGE_TO_CLIENT")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("26")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("                   "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//server将广播消息推送给client")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("BROADCAST_MESSAGE_TO_CLIENT_ACK")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("27")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("               "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//client收到广播消息后ACK给server")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//重定向指令")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("REDIRECT_TO_CLIENT")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("30")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("                            "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//server将重定向指令推动给client")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h4",{attrs:{id:"_4-client发起交互"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-client发起交互"}},[t._v("#")]),t._v(" 4. Client发起交互")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("场景")]),t._v(" "),a("th",[t._v("Client向Server发送消息命令字")]),t._v(" "),a("th",[t._v("Server回复Client消息的命令字")]),t._v(" "),a("th",[t._v("说明")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("握手")]),t._v(" "),a("td",[t._v("HELLO_REQUEST")]),t._v(" "),a("td",[t._v("HELLO_RESPONSE")]),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[t._v("心跳")]),t._v(" "),a("td",[t._v("HEARTBEAT_REQUEST")]),t._v(" "),a("td",[t._v("HEARTBEAT_RESPONSE")]),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[t._v("订阅")]),t._v(" "),a("td",[t._v("SUBSCRIBE_REQUEST")]),t._v(" "),a("td",[t._v("SUBSCRIBE_RESPONSE")]),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[t._v("取消订阅")]),t._v(" "),a("td",[t._v("UNSUBSCRIBE_REQUEST")]),t._v(" "),a("td",[t._v("UNSUBSCRIBE_RESPONSE")]),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[t._v("开始监听消息")]),t._v(" "),a("td",[t._v("LISTEN_REQUEST")]),t._v(" "),a("td",[t._v("LISTEN_RESPONSE")]),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[t._v("发送RR请求")]),t._v(" "),a("td",[t._v("REQUEST_TO_SERVER")]),t._v(" "),a("td",[t._v("RESPONSE_TO_CLIENT")]),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[t._v("发送RR回包")]),t._v(" "),a("td",[t._v("RESPONSE_TO_SERVER")]),t._v(" "),a("td",[t._v("无")]),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[t._v("发送异步事件")]),t._v(" "),a("td",[t._v("ASYNC_MESSAGE_TO_SERVER")]),t._v(" "),a("td",[t._v("ASYNC_MESSAGE_TO_SERVER_ACK")]),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[t._v("发送广播事件")]),t._v(" "),a("td",[t._v("BROADCAST_MESSAGE_TO_SERVER")]),t._v(" "),a("td",[t._v("BROADCAST_MESSAGE_TO_SERVER_ACK")]),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[t._v("客户端主动断连")]),t._v(" "),a("td",[t._v("CLIENT_GOODBYE_REQUEST")]),t._v(" "),a("td",[t._v("CLIENT_GOODBYE_RESPONSE")]),t._v(" "),a("td")])])]),t._v(" "),a("h4",{attrs:{id:"_5-server发起交互"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-server发起交互"}},[t._v("#")]),t._v(" 5. Server发起交互")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("场景")]),t._v(" "),a("th",[t._v("Server向Client发送消息命令字")]),t._v(" "),a("th",[t._v("Client回复Server消息命令字")]),t._v(" "),a("th",[t._v("说明")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("客户端接收RR请求")]),t._v(" "),a("td",[t._v("REQUEST_TO_CLIENT")]),t._v(" "),a("td",[t._v("REQUEST_TO_CLIENT_ACK")]),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[t._v("客户端接收RR回包")]),t._v(" "),a("td",[t._v("RESPONSE_TO_CLIENT")]),t._v(" "),a("td",[t._v("RESPONSE_TO_CLIENT_ACK")]),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[t._v("客户端接收异步事件")]),t._v(" "),a("td",[t._v("ASYNC_MESSAGE_TO_CLIENT")]),t._v(" "),a("td",[t._v("ASYNC_MESSAGE_TO_CLIENT_ACK")]),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[t._v("客户端接收广播事件")]),t._v(" "),a("td",[t._v("BROADCAST_MESSAGE_TO_CLIENT")]),t._v(" "),a("td",[t._v("BROADCAST_MESSAGE_TO_CLIENT_ACK")]),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[t._v("服务端主动断连")]),t._v(" "),a("td",[t._v("SERVER_GOODBYE_REQUEST")]),t._v(" "),a("td",[t._v("无")]),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[t._v("服务端进行重定向")]),t._v(" "),a("td",[t._v("REDIRECT_TO_CLIENT")]),t._v(" "),a("td",[t._v("无")]),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td"),t._v(" "),a("td"),t._v(" "),a("td"),t._v(" "),a("td")])])]),t._v(" "),a("h4",{attrs:{id:"_6-消息类型"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-消息类型"}},[t._v("#")]),t._v(" 6. 消息类型")]),t._v(" "),a("ul",[a("li",[t._v("发送RR消息")])]),t._v(" "),a("p",[a("img",{attrs:{src:n(323),alt:"rr-msg"}})]),t._v(" "),a("ul",[a("li",[t._v("发送异步单播消息")])]),t._v(" "),a("p",[a("img",{attrs:{src:n(324),alt:"async-msg"}})]),t._v(" "),a("ul",[a("li",[t._v("发送广播消息")])]),t._v(" "),a("p",[a("img",{attrs:{src:n(325),alt:"broadcast-msg"}})]),t._v(" "),a("h2",{attrs:{id:"http协议文档"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#http协议文档"}},[t._v("#")]),t._v(" HTTP协议文档")]),t._v(" "),a("p",[t._v("Java类"),a("code",[t._v("LiteMessage")]),t._v("的"),a("code",[t._v("content")]),t._v("字段表示一个特殊的协议，因此，如果您要使用eventmesh-sdk-java的http-client，则只需设计协议的"),a("code",[t._v("content")]),t._v("即可。"),a("code",[t._v("LiteMessage")]),t._v("组成如下：")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("LiteMessage")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" bizSeqNo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" uniqueId"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" topic"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" content"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Map")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" prop"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("long")]),t._v(" createTime "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("currentTimeMillis")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h4",{attrs:{id:"_1-消息发送方式与组成"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-消息发送方式与组成"}},[t._v("#")]),t._v(" 1. 消息发送方式与组成")]),t._v(" "),a("p",[a("strong",[t._v("消息发送方式")]),t._v("：POST方式")]),t._v(" "),a("p",[a("strong",[t._v("消息组成")]),t._v("：请求头(RequestHeader) + 请求体(RequestBody)")]),t._v(" "),a("ul",[a("li",[t._v("心跳消息")])]),t._v(" "),a("p",[a("strong",[t._v("RequestHeader")])]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("Key")]),t._v(" "),a("th",[t._v("说明")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("Env")]),t._v(" "),a("td",[t._v("client所属环境")])]),t._v(" "),a("tr",[a("td",[t._v("Region")]),t._v(" "),a("td",[t._v("client所属区域")])]),t._v(" "),a("tr",[a("td",[t._v("Idc")]),t._v(" "),a("td",[t._v("client所属IDC")])]),t._v(" "),a("tr",[a("td",[t._v("Dcn")]),t._v(" "),a("td",[t._v("client所在DCN")])]),t._v(" "),a("tr",[a("td",[t._v("Sys")]),t._v(" "),a("td",[t._v("client所属子系统")])]),t._v(" "),a("tr",[a("td",[t._v("Pid")]),t._v(" "),a("td",[t._v("client进程号")])]),t._v(" "),a("tr",[a("td",[t._v("Ip")]),t._v(" "),a("td",[t._v("client Ip")])]),t._v(" "),a("tr",[a("td",[t._v("Username")]),t._v(" "),a("td",[t._v("client 用户名")])]),t._v(" "),a("tr",[a("td",[t._v("Passwd")]),t._v(" "),a("td",[t._v("client 密码")])]),t._v(" "),a("tr",[a("td",[t._v("Version")]),t._v(" "),a("td",[t._v("协议版本")])]),t._v(" "),a("tr",[a("td",[t._v("Language")]),t._v(" "),a("td",[t._v("语言描述")])]),t._v(" "),a("tr",[a("td",[t._v("Code")]),t._v(" "),a("td",[t._v("请求码")])])])]),t._v(" "),a("p",[a("strong",[t._v("RequestBody")])]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("Key")]),t._v(" "),a("th",[t._v("说明")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("clientType")]),t._v(" "),a("td",[t._v("客户端类型")])]),t._v(" "),a("tr",[a("td",[t._v("heartbeatEntities")]),t._v(" "),a("td",[t._v("心跳实体，包含topic、url等信息")])])])]),t._v(" "),a("ul",[a("li",[t._v("订阅消息：")])]),t._v(" "),a("p",[a("strong",[t._v("RequestHeader")])]),t._v(" "),a("p",[t._v("与心跳消息一致")]),t._v(" "),a("p",[a("strong",[t._v("RequestBody")])]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("Key")]),t._v(" "),a("th",[t._v("说明")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("topic")]),t._v(" "),a("td",[t._v("客户端订阅的topic")])]),t._v(" "),a("tr",[a("td",[t._v("url")]),t._v(" "),a("td",[t._v("topic对应的url")])])])]),t._v(" "),a("ul",[a("li",[t._v("取消订阅消息：")])]),t._v(" "),a("p",[a("strong",[t._v("RequestHeader")])]),t._v(" "),a("p",[t._v("与心跳消息一致")]),t._v(" "),a("p",[a("strong",[t._v("RequestBody")])]),t._v(" "),a("p",[t._v("与订阅消息一致")]),t._v(" "),a("ul",[a("li",[t._v("发送异步事件：")])]),t._v(" "),a("p",[a("strong",[t._v("RequestHeader")])]),t._v(" "),a("p",[t._v("与心跳消息一致")]),t._v(" "),a("p",[a("strong",[t._v("RequestBody")])]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("Key")]),t._v(" "),a("th",[t._v("说明")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("topic")]),t._v(" "),a("td",[t._v("客户端请求的topic")])]),t._v(" "),a("tr",[a("td",[t._v("content")]),t._v(" "),a("td",[t._v("客户端发送的topic的内容")])]),t._v(" "),a("tr",[a("td",[t._v("ttl")]),t._v(" "),a("td",[t._v("客户端请求超时时间")])]),t._v(" "),a("tr",[a("td",[t._v("bizSeqNo")]),t._v(" "),a("td",[t._v("客户端请求业务流水号")])]),t._v(" "),a("tr",[a("td",[t._v("uniqueId")]),t._v(" "),a("td",[t._v("客户端请求消息唯一标识")])])])]),t._v(" "),a("h4",{attrs:{id:"_2-client发起交互"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-client发起交互"}},[t._v("#")]),t._v(" 2. Client发起交互")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("场景")]),t._v(" "),a("th",[t._v("Client向Server发送消息请求码")]),t._v(" "),a("th",[t._v("Server回复Client消息的响应码")]),t._v(" "),a("th",[t._v("说明")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("心跳")]),t._v(" "),a("td",[t._v("HEARTBEAT(203)")]),t._v(" "),a("td",[t._v("SUCCESS(0)/PROXY_HEARTBEAT_ERROR(19)")]),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[t._v("订阅")]),t._v(" "),a("td",[t._v("SUBSCRIBE(206)")]),t._v(" "),a("td",[t._v("SUCCESS(0)/PROXY_SUBSCRIBE_ERROR(17)")]),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[t._v("取消订阅")]),t._v(" "),a("td",[t._v("UNSUBSCRIBE(207)")]),t._v(" "),a("td",[t._v("SUCCESS(0)/PROXY_UNSUBSCRIBE_ERROR(18)")]),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[t._v("发送异步事件")]),t._v(" "),a("td",[t._v("MSG_SEND_ASYNC(104)")]),t._v(" "),a("td",[t._v("SUCCESS(0)/PROXY_SEND_ASYNC_MSG_ERR(14)")]),t._v(" "),a("td")])])]),t._v(" "),a("h4",{attrs:{id:"_3-server发起交互"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-server发起交互"}},[t._v("#")]),t._v(" 3. Server发起交互")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("场景")]),t._v(" "),a("th",[t._v("Server向Client发送消息请求码")]),t._v(" "),a("th",[t._v("Client回复Server消息响应码")]),t._v(" "),a("th",[t._v("说明")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("客户端接收异步事件")]),t._v(" "),a("td",[t._v("HTTP_PUSH_CLIENT_ASYNC(105)")]),t._v(" "),a("td",[t._v("retCode")]),t._v(" "),a("td",[t._v("retCode值为0时代表成功")])])])])])}),[],!1,null,null,null);s.default=e.exports}}]);